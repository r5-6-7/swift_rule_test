id: rule_not_working_swift
language: swift
severity: warning
message: >-
  Dummy message
  
utils:
    match_pattern_try_expression_directly:
        kind: try_expression
        has:
            stopBy: neighbor
            kind: call_expression
            all:
                - has:
                      stopBy: neighbor
                      kind: simple_identifier
                      regex: '^Blowfish$'
                - has:
                      stopBy: neighbor
                      kind: call_suffix
                      has:
                          stopBy: neighbor
                          kind: value_arguments
                          has:
                              stopBy: neighbor
                              kind: value_argument
                              all:
                                  - has:
                                        stopBy: neighbor
                                        kind: simple_identifier
                                        regex: '^key$'
                                  - has:
                                        stopBy: neighbor
                                        kind: line_string_literal
                                        has:
                                            stopBy: neighbor
                                            kind: line_str_text

    match_pattern_Blowfish_statement_directly:
     kind: call_expression
     all:
                - has:
                      stopBy: neighbor
                      kind: simple_identifier
                      regex: '^Blowfish$'
                - has:
                      stopBy: neighbor
                      kind: call_suffix
                      has:
                          stopBy: neighbor
                          kind: value_arguments
                          has:
                              stopBy: neighbor
                              kind: value_argument
                              all:
                                  - has:
                                        stopBy: neighbor
                                        kind: simple_identifier
                                        regex: '^key$'
                                  - has:
                                        stopBy: neighbor
                                        kind: line_string_literal
                                        has:
                                            stopBy: neighbor
                                            kind: line_str_text
                - not:
                      inside:
                          stopBy: neighbor
                          kind: try_expression

    match_pattern_Blowfish_expression_with_instance:
      kind: call_expression
      all:
                - has:
                      stopBy: neighbor
                      kind: simple_identifier
                      regex: '^Blowfish$'
                - has:
                      stopBy: neighbor
                      kind: call_suffix
                      has:
                          stopBy: neighbor
                          kind: value_arguments
                          has:
                              stopBy: neighbor
                              kind: value_argument
                              all:
                                  - has:
                                        stopBy: neighbor
                                        kind: simple_identifier
                                        regex: '^key$'
                                  - has:
                                        stopBy: end
                                        kind: simple_identifier
                                        nthChild: 2
                                        pattern: $R
                - not:
                      inside:
                          stopBy: neighbor
                          kind: try_expression
                - follows:
                      stopBy: end
                      kind: property_declaration
                      all:
                          - has:
                                stopBy: end
                                kind: pattern
                                has:
                                    stopBy: end
                                    kind: simple_identifier
                                    pattern: $R
                          - has:
                                stopBy: neighbor
                                kind: call_expression
                                pattern: Array("$$$".utf8)  
 
    match_pattern_try_expression_with_instance:
     kind: try_expression
     all:
      - has:
         stopBy: neighbor
         kind: call_expression
         all:
                - has:
                      stopBy: neighbor
                      kind: simple_identifier
                      regex: '^Blowfish$'
                - has:
                      stopBy: neighbor
                      kind: call_suffix
                      has:
                          stopBy: neighbor
                          kind: value_arguments
                          has:
                              stopBy: neighbor
                              kind: value_argument
                              all:
                                  - has:
                                        stopBy: neighbor
                                        kind: simple_identifier
                                        regex: '^key$'
                                  - has:
                                        stopBy: end
                                        kind: simple_identifier
                                        nthChild: 2
                                        pattern: $R
      - follows:
                      stopBy: end
                      kind: property_declaration
                      all:
                          - has:
                                stopBy: end
                                kind: pattern
                                has:
                                    stopBy: end
                                    kind: simple_identifier
                                    pattern: $R
                          - has:
                                stopBy: neighbor
                                kind: call_expression
                                pattern: Array("$$$".utf8)         
               
rule:
    any:
        - kind: try_expression
          any:
              - matches: match_pattern_try_expression_directly
              - matches:  match_pattern_try_expression_with_instance
              
        - kind: call_expression
          any:
            - matches: match_pattern_Blowfish_statement_directly
            - matches: match_pattern_Blowfish_expression_with_instance
